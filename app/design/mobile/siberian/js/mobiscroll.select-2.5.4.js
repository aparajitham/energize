(function(e){var t={inputClass:"",invalid:[],rtl:false,group:false,groupLabel:"Groups"};e.mobiscroll.presetShort("select");e.mobiscroll.presets.select=function(n){function N(e){return e?e.replace(/_/,""):""}function C(){var t,n=0,r={},o=[{}];if(i.group){if(i.rtl){n=1}e("optgroup",s).each(function(t){r["_"+t]=e(this).attr("label")});o[n]={};o[n][i.groupLabel]=r;t=f;n+=i.rtl?-1:1}else{t=s}o[n]={};o[n][v]={};e("option",t).each(function(){var t=e(this).attr("value");o[n][v]["_"+t]=e(this).text();if(e(this).prop("disabled")){m.push(t)}});return o}function k(e,t){var r=[];if(o){var i=[],u=0;for(u in n._selectedValues){i.push(y[u]);r.push(u)}S.val(i.join(", "))}else{S.val(e);r=t?N(n.values[w]):null}if(t){h=true;s.val(r).trigger("change")}}var r=n.settings,i=e.extend({},t,r),s=e(this),o=s.prop("multiple"),u=this.id+"_dummy",a=o?s.val()?s.val()[0]:e("option",s).attr("value"):s.val(),f=s.find('option[value="'+a+'"]').parent(),l=f.index()+"",c=l,h,p=e('label[for="'+this.id+'"]').attr("for",u),d=e('label[for="'+u+'"]'),v=i.label!==undefined?i.label:d.length?d.text():s.attr("name"),m=[],g=[],y={},b,w,E,S,x=r.readonly,T;if(i.group&&!e("optgroup",s).length){i.group=false}if(!i.invalid.length){i.invalid=m}if(i.group){if(i.rtl){b=1;w=0}else{b=0;w=1}}else{b=-1;w=0}e("#"+u).remove();S=e('<input type="text" id="'+u+'" class="'+i.inputClass+'" readonly />').insertBefore(s),e("option",s).each(function(){y[e(this).attr("value")]=e(this).text()});if(i.showOnFocus){S.focus(function(){n.show()})}var L=s.val()||[],A=0;for(A;A<L.length;A++){n._selectedValues[L[A]]=L[A]}k(y[a]);s.unbind(".dwsel").bind("change.dwsel",function(){if(!h){n.setSelectVal(o?s.val()||[]:[s.val()],true)}h=false}).hide().closest(".ui-field-contain").trigger("create");n.setSelectVal=function(t,u,h){a=t[0]||e("option",s).attr("value");if(o){n._selectedValues={};var p=0;for(p;p<t.length;p++){n._selectedValues[t[p]]=t[p]}}if(i.group){f=s.find('option[value="'+a+'"]').parent();c=f.index();n.temp=i.rtl?["_"+a,"_"+f.index()]:["_"+f.index(),"_"+a];if(c!==l){r.wheels=C();n.changeWheel([w]);l=c+""}}else{n.temp=["_"+a]}n.setValue(true,u,h);if(u){var d=o?true:a!==s.val();k(y[a],d)}};n.getSelectVal=function(e){var t=e?n.temp:n.values;return N(t[w])};return{width:50,wheels:T,headerText:false,multiple:o,anchor:S,formatResult:function(e){return y[N(e[w])]},parseValue:function(){var t=s.val()||[],r=0;if(o){n._selectedValues={};for(r;r<t.length;r++){n._selectedValues[t[r]]=t[r]}}a=o?s.val()?s.val()[0]:e("option",s).attr("value"):s.val();f=s.find('option[value="'+a+'"]').parent();c=f.index();l=c+"";return i.group&&i.rtl?["_"+a,"_"+c]:i.group?["_"+c,"_"+a]:["_"+a]},validate:function(t,u,h){if(u===undefined&&o){var p=n._selectedValues,d=0;for(d in p){e(".dwwl"+w+' .dw-li[data-val="_'+p[d]+'"]',t).addClass("dw-msel")}}if(u===b){c=N(n.temp[b]);if(c!==l){f=s.find("optgroup").eq(c);c=f.index();a=f.find("option").eq(0).val();a=a||s.val();r.wheels=C();if(i.group){n.temp=i.rtl?["_"+a,"_"+c]:["_"+c,"_"+a];r.readonly=[i.rtl,!i.rtl];clearTimeout(E);E=setTimeout(function(){n.changeWheel([w]);r.readonly=x;l=c+""},h*1e3);return false}}else{r.readonly=x}}else{a=N(n.temp[w])}var v=e(".dw-ul",t).eq(w);e.each(i.invalid,function(t,n){e('.dw-li[data-val="_'+n+'"]',v).removeClass("dw-v")})},onBeforeShow:function(e){r.wheels=C();if(i.group){n.temp=i.rtl?["_"+a,"_"+f.index()]:["_"+f.index(),"_"+a]}},onMarkupReady:function(t){e(".dwwl"+b,t).bind("mousedown touchstart",function(){clearTimeout(E)});if(o){t.addClass("dwms");e(".dwwl",t).eq(w).addClass("dwwms");g={};var r;for(r in n._selectedValues){g[r]=n._selectedValues[r]}}},onValueTap:function(e){if(o&&e.hasClass("dw-v")&&e.closest(".dw").find(".dw-ul").index(e.closest(".dw-ul"))==w){var t=N(e.attr("data-val"));if(e.hasClass("dw-msel")){delete n._selectedValues[t]}else{n._selectedValues[t]=t}e.toggleClass("dw-msel");if(i.display=="inline"){k(t,true)}return false}},onSelect:function(e){k(e,true);if(i.group){n.values=null}},onCancel:function(){if(i.group){n.values=null}if(o){n._selectedValues={};var e;for(e in g){n._selectedValues[e]=g[e]}}},onChange:function(e){if(i.display=="inline"&&!o){S.val(e);h=true;s.val(N(n.temp[w])).trigger("change")}},onClose:function(){S.blur()},methods:{setValue:function(t,n,r){return this.each(function(){var i=e(this).mobiscroll("getInst");if(i){if(i.setSelectVal){i.setSelectVal(t,n,r)}else{i.temp=t;i.setValue(true,n,r)}}})},getValue:function(t){var n=e(this).mobiscroll("getInst");if(n){return n.getSelectVal?n.getSelectVal(t):n.values}}}}}})(jQuery)